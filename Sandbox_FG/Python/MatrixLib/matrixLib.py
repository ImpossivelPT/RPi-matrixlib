# -*- coding: utf-8 -*-

# original: http://dangerousprototypes.com/2012/10/04/driving-4-8x8-led-matrices-via-the-ht1632c-and-an-arduino/
import RPi.GPIO as GPIO
from time import sleep
import unicodedata

delay = 0

def dataON():
    GPIO.output(DISPLAY_WR, False)
    sleep(delay)
    GPIO.output(DISPLAY_DATA, True)
    print 1
    sleep(delay)
    GPIO.output(DISPLAY_WR, True)
    sleep(delay)
    
def dataOFF():
    GPIO.output(DISPLAY_WR, False)
    sleep(delay)
    GPIO.output(DISPLAY_DATA, False)
    print 0
    sleep(delay)
    GPIO.output(DISPLAY_WR, True)
    sleep(delay)
    
def writeMatrix(array,nMatrix):
    if nMatrix == 1:
        GPIO.output(DISPLAY_CS1, False)
    elif nMatrix == 2:
        GPIO.output(DISPLAY_CS2, False)

    for index in range(len(array)):
        if array[index] == 1:
            dataON()
        else:
            dataOFF()
            
    if nMatrix == 1:
        GPIO.output(DISPLAY_CS1, True)
    elif nMatrix == 2:
        GPIO.output(DISPLAY_CS2, True)

# dont stop    
def writeMatrixDS(array,nMatrix):
    if nMatrix == 1:
        GPIO.output(DISPLAY_CS1, False)
    elif nMatrix == 2:
        GPIO.output(DISPLAY_CS2, False)

    for index in range(len(array)):
        if array[index] == 1:
            dataON()
        else:
            dataOFF()
            
def injectoToMatrix(array):
    for index in range(len(array)):
        if array[index] == 1:
            dataON()
        else:
            dataOFF()
        
def matrixWriteMode(nMatrix):
    led = [1,0,1,0,0,0,0,0,0,0]
    writeMatrixDS(led,nMatrix)
    
    
def startMatrix(nMatrix):
    systemEnable(nMatrix)
    sleep(delay)
    #led = [1,0,0,0,0,0,0,0,0,1,1,0,0] # LED ON
    #writeMatrix(led,nMatrix)
    enableLed(nMatrix)

def systemEnable(nMatrix):
    led = [1,0,0,0,0,0,0,0,0,0,1,0,0] # SYS EN
    writeMatrix(led,nMatrix)

def systemDisable(nMatrix):
    led = [1,0,0,0,0,0,0,0,0,0,0,0,0] # SYS EN
    writeMatrix(led,nMatrix)
    

def drawString(string):
    #string = strip_accents(string)
    #disableLed(1)
    #disableLed(2)
    
    clearMatrix(2)
    string = list(string)
    finalString = ''
    
    for index in range(len(string)):
        finalString += Letras[string[index].encode("hex")] + ',' + space
        #finalString += ''.join(Letras[string[index]])
        #print type(Letras[string[index]])
        
    #apaga o ultimo char
    finalstring = finalString[:-1]
    
    finalArray = eval(finalString)
    
    if(len(finalArray) >= 256):
    
        finalArray1 = finalArray[:256]
        finalArray2 = finalArray[256:512]
        
        startWrite = [1,0,1,0,0,0,0,0,0,0]
        writeMatrixDS(startWrite,1)
        writeMatrix(finalArray1,1)
        
        startWrite = [1,0,1,0,0,0,0,0,0,0]
        writeMatrixDS(startWrite,2)
        writeMatrix(finalArray2,2)
    else:
        finalArray = finalArray
        
        startWrite = [1,0,1,0,0,0,0,0,0,0]
        writeMatrixDS(startWrite,1)
        
        writeMatrix(finalArray,1)
        
    #enableLed(1)
    #enableLed(2)

def clearMatrix(nMatrix):
    clearArray = [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    for index in range(1,nMatrix+1):
        writeMatrix(clearArray,index)
    
    """
    startWrite = [1,0,1,0,0,0,0,0,0,0]
    writeMatrixDS(startWrite,1)
    
    
    injectoToMatrix(finalArray)
    """
    
def disableLed(nMatrix):
    led = [1,0,0,0,0,0,0,0,0,1,0,0,0]
    writeMatrix(led,nMatrix)
    
def enableLed(nMatrix):
    led = [1,0,0,0,0,0,0,0,0,1,1,0,0]
    writeMatrix(led,nMatrix)
    
def strip_accents(string):
    return unicodedata.normalize('NFKD', string).encode('ASCII', 'ignore')

# define pins
DISPLAY_CS1     = 17
DISPLAY_CS2     = 4
DISPLAY_WR      = 27
DISPLAY_DATA    = 22

# pins BCM nao BOARD
GPIO.setmode(GPIO.BCM)


# pins
GPIO.setup(DISPLAY_CS1, GPIO.OUT)
GPIO.setup(DISPLAY_CS2, GPIO.OUT)
GPIO.setup(DISPLAY_WR, GPIO.OUT)
GPIO.setup(DISPLAY_DATA, GPIO.OUT)

#tudo a zero
GPIO.output(DISPLAY_WR, False)
GPIO.output(DISPLAY_DATA, False)
GPIO.output(DISPLAY_CS1, True)
GPIO.output(DISPLAY_CS2, True)



#startMatrix(1)
#startMatrix(2)










sleep(delay)
Letras = {}
Letras['41'] = '0,0,1,1,1,1,1,1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,1,1,1,1,1,1'
Letras['42'] = '0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,0,1,1,1,0'
Letras['43'] = '0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,1,0,0,0,1,0'
Letras['44'] = '0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,0'
Letras['45'] = '0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1'
Letras['46'] = '0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0'
Letras['47'] = '0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,1,1,1,0'
Letras['48'] = '0,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,1,1'
Letras['49'] = '0,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,1'
Letras['4a'] = '0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,0'
Letras['4b'] = '0,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,1,1'
Letras['4c'] = '0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1'
Letras['4d'] = '0,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1'
Letras['4e'] = '0,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,1,1'
Letras['4f'] = '0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,0'
Letras['50'] = '0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0'
Letras['51'] = '0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1'
Letras['52'] = '0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,1,1,1,1'
Letras['53'] = '0,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,0,1,1,1,0'
Letras['54'] = '0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0'
Letras['55'] = '0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,0'
Letras['56'] = '0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,0'
Letras['57'] = '0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1'
Letras['58'] = '0,1,0,0,0,1,1,1,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,1,1'
Letras['59'] = '0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0'
Letras['5a'] = '0,1,0,0,0,0,1,1,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,0,0,1,0,1,1,0,0,0,0,1'

Letras['61'] = '0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,0,1,1,1,1'
Letras['62'] = '0,1,1,1,1,1,1,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0'
Letras['63'] = '0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0'
Letras['64'] = '0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1,0,1,1,1,1,1,1,1'
Letras['65'] = '0,0,0,0,1,1,1,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,0,1,1,0,1'
Letras['66'] = '0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0'
Letras['67'] = '0,0,0,1,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,1,1,1,1,0'
Letras['68'] = '0,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1'
Letras['69'] = '0,1,0,1,1,1,1,1'
Letras['6a'] = '0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,1,1,1,1,0'
Letras['6b'] = '0,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1'
Letras['6c'] = '0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1'
Letras['6d'] = '0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1'
Letras['6e'] = '0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1'
Letras['6f'] = '0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0'
Letras['70'] = '0,0,1,1,1,1,1,1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,1,1,0,0,0'
Letras['71'] = '0,0,0,1,1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,1,1,1,1,1,1'
Letras['72'] = '0,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0'
Letras['73'] = '0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,0'
Letras['74'] = '0,0,0,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,0,0,1'
Letras['75'] = '0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1'
Letras['76'] = '0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0'
Letras['77'] = '0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1'
Letras['78'] = '0,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1'
Letras['79'] = '0,0,1,1,1,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,1,1,1,1,1,0'
Letras['7a'] = '0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,0,1'

Letras['30'] = '0,0,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1,1,1,1,0'
Letras['31'] = '0,0,1,0,0,0,0,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1'
Letras['32'] = '0,0,1,0,0,0,1,1,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,1'
Letras['33'] = '0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,0,1,1,0'
Letras['34'] = '0,0,0,0,1,1,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1,1,1'
Letras['35'] = '0,1,1,1,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,0,1,1,1,0'
Letras['36'] = '0,0,0,1,1,1,1,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,0,0,0,1,1,0'
Letras['37'] = '0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,1,0,1,0,0,1,0,0,0,0,1,1,1,0,0,0,0'
Letras['38'] = '0,0,1,1,0,1,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,0,1,1,0'
Letras['39'] = '0,0,1,1,0,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,1,1,1,0,0'



Letras['3a'] = '0,0,0,1,0,0,1,0'
Letras['3b'] = '0,0,0,1,0,0,1,1'
Letras['2e'] = '0,0,0,0,0,0,0,1'
Letras['2c'] = '0,0,0,0,0,0,1,1'
Letras['2d'] = '0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0'
Letras['27'] = '0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0'
Letras['28'] = '0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1'
Letras['29'] = '0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,0'
Letras['3c'] = '0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,0'
Letras['3e'] = '0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0'


Letras['21'] = '0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0'


space = '0,0,0,0,0,0,0,0,0'






